(function(n){app.modals.ChangeProfilePictureModal=function(){var r,t=null,i=null,u=abp.services.app.profile;this.init=function(u){r=u;n("#ChangeProfilePictureModalForm input[name=ProfilePicture]").change(function(){n("#ChangeProfilePictureModalForm").submit()});n("#ChangeProfilePictureModalForm").ajaxForm({beforeSubmit:function(){var u=n("#ChangeProfilePictureModalForm input[name=ProfilePicture]"),i=u.get()[0].files,t,r;return i.length?(t=i[0],r="|"+t.type.slice(t.type.lastIndexOf("/")+1)+"|","|jpg|jpeg|png|".indexOf(r)===-1)?(abp.message.warn(app.localize("ProfilePicture_Warn_FileType")),!1):t.size>5242880?(abp.message.warn(app.localize("ProfilePicture_Warn_SizeLimit")),!1):!0:!1},success:function(r){var u,f,e;r.success?(u=n("#ProfilePictureResize"),f=r.result.height*u.width()/r.result.width,u.height(f+"px"),e=abp.appPath+"Temp/Downloads/"+r.result.fileName+"?v="+(new Date).valueOf(),i=r.result.fileName,t&&t.data("Jcrop").destroy(),u.show(),u.attr("src",e),t=u.Jcrop({trueSize:[r.result.width,r.result.height],setSelect:[0,0,100,100],aspectRatio:1})):abp.message.error(r.error.message)}});n("#ProfilePictureResize").hide()};this.save=function(){if(i){var f={};t&&(f=t.data("Jcrop").tellSelect());u.updateProfilePicture({fileName:i,x:parseInt(f.x),y:parseInt(f.y),width:parseInt(f.w),height:parseInt(f.h)}).done(function(){t.data("Jcrop").destroy();t=null;n("#HeaderProfilePicture").attr("src",app.getUserProfilePicturePath());r.close()})}}}})(jQuery);